<!DOCTYPE html>
<html lang="">
<head>
<meta charset="utf-8">
<title></title>
<style>
label {
  font-size: 20px;
  font-family: Arial;
  font-weight: bold;
  color: white;
}
h1 {
color: white;
}
button, input {
  width: 90%;
  height: 50px;
  font-size: 20px;
  font-family: Fixed;
  margin-left: auto;
  margin-right: auto;
}
body {
  background-color: #234276;
}
button {
  font-family: Arial;
}
#dbg {
  font-size: 10px;
}
#fleg{
width: 100%;
  height: 20px;
  background-color:#234276;
}
</style>
<script >
    let wvq_tickerInterval=500;
    let wvq_lastMessage="";
    let wvq_currentMessage="";
    let wvq_first=true;
    var wvq_busy=false;
    
    function wvq_sendToAndroid() {
      clearInterval(watchTimer);
      document.removeEventListener('wvq', wvq_readFromAndroid);
      var msg=document.getElementById('tx').value;
      window.AppInventor.fachtnaSetWebViewString(msg);
      document.addEventListener('wvq', wvq_readFromAndroid);
      watchTimer=setInterval(wvq_watcher,wvq_tickerInterval);
    }
    
    function wvq_readFromAndroid(){
      clearInterval(watchTimer);
      document.removeEventListener('wvq', wvq_readFromAndroid);
      var msg =window.AppInventor.getWebViewString();
      document.getElementById('rx').value=msg;
      wvq_first=true;
      document.addEventListener('wvq', wvq_readFromAndroid);
      watchTimer=setInterval(wvq_watcher,wvq_tickerInterval);
    }
    
    function dbg(str) {
      document.getElementById('dbg').value=str;
    }
    function wvq_watcher() {
      document.getElementById('fleg').style.BackgroundColor="red";
      var now = new Date();
      var ticks = now.getTime();
      dbg(ticks);
      if (wvq_first) {
        window.AppInventor.getWebViewString();
        window.AppInventor.getWebViewString();
        wvq_first=false;
      }
      if (!wvq_busy) {
        wvq_busy=true;
        temp=window.AppInventor.getWebViewString();
        if ((wvq_currentMessage != temp) ) {
          wvq_lastMessage=wvq_currentMessage;
          wvq_currentMessage=temp;
          inbound=new CustomEvent("wvq");
          document.dispatchEvent(inbound);
        }
        wvq_busy=false;
      }
      // document.getElementById('fleg').style.BackgroundColor="#234276";
    }
    document.addEventListener('wvq', wvq_readFromAndroid);
    watchTimer=setInterval(wvq_watcher, wvq_tickerInterval);
</script>
</head>
<body>
    <h1>HTML</h1>
    <label for="rx">Receive</label><br>
    <input type="text" name="rx" id="rx"><br><br>
    <label for="tx">Send</label><br>
    <input type="text" name="tx" id="tx" value="This is html"><br><br>
    <button type="button" id="send" name="send" onclick="wvq_sendToAndroid()">Send</button><br><br>
    <input type="text" name="dbg" id="dbg" readonly value="---"><br>
    <div id="fleg"></div>
</body>
</html>
